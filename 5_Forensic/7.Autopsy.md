# Chứng chỉ Blue Team Level 1 (Tiêu chuẩn)
## Lĩnh vực Điều tra Số - DF7 Autopsy

### AUTOPSY LÀ GÌ?

Autopsy là một công cụ đạt chuẩn điều tra số được quân đội, cơ quan thực thi pháp luật và các điều tra viên trong doanh nghiệp sử dụng để điều tra những gì đã xảy ra trên điện thoại thông minh hoặc máy tính. Autopsy có cấu trúc plug-in (trình cắm), cho phép người dùng tìm các mô-đun bổ sung hoặc thậm chí tự phát triển các mô-đun tùy chỉnh bằng ngôn ngữ Java hoặc Python, giúp mở rộng các chức năng và khả năng tự động hóa. Công cụ tuyệt vời này được tích hợp sẵn trong hệ điều hành Kali Linux, đồng thời cũng có thể được tải xuống và sử dụng miễn phí trên các hệ thống chạy hệ điều hành Windows.

---

### Các Tính năng Chính của Autopsy

* **Các vụ án nhiều người dùng (Multi-User Cases)**: Hợp tác với các điều tra viên khác trong các vụ án lớn.
* **Tìm kiếm từ khóa (Keyword Search)**: Trích xuất văn bản và các mô-đun tìm kiếm được lập chỉ mục cho phép bạn tìm các tệp chứa các thuật ngữ cụ thể và tìm các mẫu biểu thức chính quy (regular expression).
* **Phân tích Dòng thời gian (Timeline Analysis)**: Hiển thị các sự kiện hệ thống trên một giao diện đồ họa để giúp xác định hoạt động.
* **Dấu vết Web (Web Artefacts)**: Trích xuất các hoạt động web từ các trình duyệt phổ biến để giúp xác định hành vi của người dùng.
* **Phân tích tệp LNK (LNK File Analysis)**: Xác định các lối tắt (shortcuts) và các tài liệu đã được truy cập.
* **Phân tích Email (Email Analysis)**: Phân tích các tin nhắn định dạng MBOX, chẳng hạn như của Thunderbird.
* **Phân tích Registry (Registry Analysis)**: Sử dụng RegRipper để xác định các tài liệu và thiết bị USB được truy cập gần đây.
* **EXIF**: Trích xuất thông tin định vị địa lý và dữ liệu máy ảnh từ các tệp JPEG.
* **Sắp xếp theo loại tệp (File Type Sorting)**: Nhóm các tệp theo loại để tìm tất cả hình ảnh hoặc tài liệu.
* **Phát phương tiện (Media Playback)**: Xem video và hình ảnh ngay trong ứng dụng mà không cần trình xem bên ngoài.
* **Trình xem ảnh thu nhỏ (Thumbnail viewer)**: Hiển thị hình thu nhỏ của các hình ảnh để giúp xem lướt nhanh các bức ảnh.
* **Phân tích Hệ thống Tệp mạnh mẽ (Robust File System Analysis)**: Hỗ trợ các hệ thống tệp thông dụng, bao gồm NTFS, FAT 12/FAT16/FAT32/ExFAT, HFS+, ISO9660 (CD-ROM), Ext2/Ext3/Ext4, Yaffs2 và UFS từ The Sleuth Kit.
* **Lọc theo tập hợp Hash (Hash Set Filtering)**: Lọc các tệp an toàn đã biết bằng cách sử dụng NSRL và gắn cờ các tệp độc hại đã biết bằng các tập hợp hash tùy chỉnh ở định dạng HashKeeper, md5sum và EnCase.
* **Gắn thẻ (Tags)**: Gắn thẻ các tệp bằng bất kỳ tên nào, chẳng hạn như 'dấu trang' (bookmark) hoặc 'đáng ngờ' (suspicious) và thêm ghi chú.
* **Trích xuất chuỗi Unicode (Unicode Strings Extraction)**: Trích xuất các chuỗi ký tự từ không gian chưa phân bổ (unallocated space) và các loại tệp không xác định bằng nhiều ngôn ngữ (tiếng Ả Rập, tiếng Trung, tiếng Nhật, v.v.).
* **Phát hiện loại tệp (File Type Detection)**: Dựa trên chữ ký (signatures) và phát hiện sự không khớp của phần mở rộng tệp.
* **Mô-đun Tệp Đáng chú ý (Interesting Files Module)**: Sẽ gắn cờ các tệp và thư mục dựa trên tên và đường dẫn của chúng.
* **Hỗ trợ Android (Android Support)**: Trích xuất dữ liệu từ tin nhắn SMS, nhật ký cuộc gọi, danh bạ, ứng dụng Tango, Words with Friends, v.v.

---
### Bắt đầu một Vụ án Mới - Nhập Nguồn Dữ liệu và Chạy các Mô-đun Xử lý (Ingest Modules)

Đầu tiên, chúng ta cần mở phần mềm Autopsy. Khi bạn thấy màn hình chào mừng, hãy nhấp vào **New Case** (Vụ án Mới).

Tại đây, chúng ta cần cung cấp tên và thư mục gốc để lưu trữ tất cả các tệp của mình. Chúng tôi đã chọn tên "BTL1AutopsyWalkthrough" và lưu nó vào một thư mục có cùng tên trong thư mục Document của chúng tôi.

Màn hình tiếp theo sẽ yêu cầu chúng ta nhập một số thông tin tùy chọn về cuộc điều tra. Chúng ta không bắt buộc phải sử dụng phần này, nhưng đây là cách các đội phản hồi sự cố và cơ quan thực thi pháp luật đính kèm các tài liệu liên quan đến tổ chức vào Autopsy.

Autopsy sau đó sẽ nhắc chúng ta thêm Nguồn Dữ liệu (Data Source). Trong trường hợp này, đó là một ảnh đĩa, vì vậy chúng ta cần chọn "Disk Image or VM File" và sau đó nhấp vào **Next**. Nhấp vào **Browse** và chọn tệp `Craig Tucker Desktop.E01` mà chúng ta đã liên kết ở đầu bài học, sau đó nhấp vào **Next** để thêm tệp này làm nguồn dữ liệu cho cuộc điều tra.

Tiếp theo, chúng ta sẽ được hỏi xem có muốn chạy bất kỳ mô-đun xử lý (ingest modules) nào không. Đây là các hành động tự động có thể được tiến hành đối với một nguồn dữ liệu để truy xuất thông tin hữu ích cho điều tra viên, giúp họ tiết kiệm thời gian. Đối với bài hướng dẫn này, chúng ta muốn chọn "All Files, Directories, and Unallocated Space" (Tất cả Tệp, Thư mục và Không gian chưa Phân bổ) từ trình đơn thả xuống, vì thao tác này sẽ chọn các mục tiêu mà các mô-đun xử lý sẽ chạy qua. Sau đó, bạn nên chọn các mục sau:
* Hoạt động gần đây (Recent Activity)
* Nhận dạng Loại Tệp (File Type Identification)
* Trích xuất Tệp Nhúng (Embedded File Extractor)
* Trình phân tích cú pháp Exif (Exif Parser)
* Trình phân tích cú pháp Email (Email Parser)
* Phát hiện Mã hóa (Encryption Detection)

Ở góc dưới bên phải, bạn sẽ thấy một thanh tiến trình cho bạn biết khi nào mỗi mô-đun xử lý đã hoàn thành. Hãy cho Autopsy vài phút để hoàn tất quá trình phân tích nguồn dữ liệu. Bạn cũng sẽ nhận thấy rằng các giá trị trên bảng điều khiển bên trái tăng lên trong khi các mô-đun xử lý đang chạy, bởi vì chúng đang khám phá các thông tin quan trọng và đặt nó vào cây dấu vết (artifact tree) để điều tra viên dễ dàng xem xét sâu hơn.

---

### Thay đổi Múi giờ của Bạn

Tùy thuộc vào múi giờ bạn đã thiết lập khi tạo vụ án, bây giờ bạn nên thay đổi nó thành **GMT +0:00**. Bạn có thể thực hiện việc này bằng cách điều hướng đến **Tools > Options > View** và đổi thành GMT ở phía bên phải màn hình.

---

### Phân tích Kết quả của Mô-đun Ingest

Lúc này, tất cả các mô-đun xử lý có lẽ đã hoàn thành và bạn sẽ không còn thấy thanh tiến trình ở góc dưới bên phải của Autopsy nữa. Cây điều hướng ở khung bên trái cũng sẽ hiển thị các con số bên cạnh các tiêu đề, cho thấy thông tin đã được tìm thấy và sắp xếp vào các danh mục khác nhau. Tiếp theo, chúng tôi sẽ hướng dẫn bạn xem xét một số thông tin mà Autopsy đã trích xuất từ ảnh ổ cứng.

Điều đầu tiên chúng ta muốn xem xét là các phân vùng (volumes) của ổ cứng để có thể thu thập thông tin như dung lượng đã phân bổ và chưa phân bổ, kích thước của các phân vùng này và định dạng đang được sử dụng. Ở đầu cây điều hướng, hãy nhấp vào biểu tượng bên cạnh **Data Sources**, sau đó nhấp vào biểu tượng bên cạnh `Craig Tucker Desktop.E01`, và bạn sẽ thấy ba phân vùng: vol 1, vol 2, vol 3. Nếu chúng ta nhấp chuột trái vào `Craig Tucker Desktop.E01`, khung bên phải sẽ hiển thị thông tin về các phân vùng được phát hiện; đây được gọi là Bảng phân vùng (Partition table).

Chúng ta có thể thấy rằng `vol2` được định dạng là NTFS/exFAT. Nó bắt đầu ở sector 2048 và có độ dài là 125825024. Đây là phần chính của ổ cứng và là nơi lưu trữ cấu trúc tệp. Mọi thứ từ người dùng (users) đến tài liệu và tệp tải xuống đều nằm trong phân vùng này. Nếu bạn nhấp đúp vào `vol2`, chúng ta sẽ được cung cấp một cấu trúc tệp ở chế độ chỉ đọc để có thể duyệt tệp giống như chúng ta đang thực sự ngồi ở chiếc máy tính xách tay đó!

Hãy dành một phút để xem qua các thư mục và xem bạn có thể tìm thấy gì. Việc làm quen với cách điều hướng các ảnh pháp y theo cách này rất hữu ích, vì những người sử dụng Windows hàng ngày có thể đã quen thuộc với việc điều hướng cấu trúc tệp này.

Bây giờ, hãy xem kết quả của các mô-đun xử lý, nằm trên cây điều hướng bên dưới tiêu đề **Results**.

---

### Khám phá Kết quả

Hãy xem qua một vài kết quả này. Để bắt đầu, hãy nhấp vào **Web History** (Lịch sử Web) ở gần dưới cùng. Mục này sẽ cho chúng ta thấy các trang web đã được truy cập trên hệ thống, bao gồm ngày truy cập, tiêu đề trang (nếu có) và chương trình được sử dụng để truy cập. Ví dụ: có dòng đánh dấu cho thấy một người dùng đã truy cập trang `4chan.org/rules` qua trình duyệt Chrome vào ngày 2013-12-18 lúc 02:35 AM GMT. Đây là một cách tuyệt vời để xem thói quen duyệt web và các trang web mà nghi phạm đã truy cập. Dấu thời gian (timestamps) cũng giúp chúng ta tạo ra một dòng thời gian của các sự kiện đã xảy ra và có thể được sử dụng để chứng minh rằng người dùng đã truy cập tài nguyên vào một ngày cụ thể.

Bây giờ, hãy xem người dùng đã xóa những tệp nào bằng cách đi tới **Recycle Bin** (Thùng rác) trong cây điều hướng. Ở khung bên phải, chúng ta có thể thấy người dùng đã xóa ba tệp, cùng với đường dẫn tệp của chúng, người dùng đã xóa chúng và thời gian tệp bị xóa. Đây có thể là một bước thu hoạch nhanh chóng nếu chúng ta đang tìm cách xác định các tệp đã bị xóa và lấy thông tin về chúng.

Chúng ta thực sự có thể xuất (export) các tệp này ra để xem xét (điều này không chỉ giới hạn ở các tệp trong thùng rác, chúng ta có thể làm điều này với bất kỳ tệp nào được xác định trong ảnh đĩa!). Nhấp chuột phải vào đường dẫn của `"Underage_lolita_r@ygold 001.jpg"` (đừng lo, hình ảnh này không có gì nhạy cảm, đây chỉ là tên ví dụ cho kịch bản điều tra). Chọn điểm đến mà bạn muốn xuất tệp tới, và tiến hành mở nó. (Hình ảnh minh họa có dòng chữ "CRIME SCENE DO NOT CROSS").

Tính năng này có thể hữu ích nếu cuộc điều tra liên quan đến bóc lột trẻ em, cho phép điều tra viên xác định các hình ảnh có khả năng nhạy cảm, xuất chúng ra và xác nhận xem tài liệu đó có thể được sử dụng làm bằng chứng trong quá trình truy tố pháp lý đối với nghi phạm hay không.

Chuyển sang phần tiếp theo, hãy xem mục **Installed Programs** (Chương trình đã cài đặt) để xác định xem phần mềm nào đã được cài đặt trên hệ thống này. Nhấp chuột trái vào tiêu đề và ở khung bên phải, chúng ta có thể thấy danh sách các chương trình đã cài đặt. Từ đây, chúng ta có thể xác định thời điểm các chương trình được cài đặt và tên của chúng, với một số mục bao gồm WinRAR, GIMP, WinZIP và Google Chrome.

Hãy cùng nhau xem qua một phần nữa, **Accounts > Email** ngay ở cuối cây điều hướng. Tại đây chúng ta có thể thấy danh sách các tệp email đã được tải xuống hệ thống, thường là thông qua một ứng dụng thư điện tử (email client). Bây giờ bạn đã hiểu cách xuất tệp bằng cách nhấp chuột phải, hãy xuất tệp email được đánh dấu và xem thử (bạn sẽ cần một ứng dụng thư điện tử nếu muốn xem nó như cách người gửi và người nhận nhìn thấy, chẳng hạn như Mozilla Thunderbird hoặc Microsoft Outlook App. Ngoài ra, bạn có thể đọc nội dung bằng cách mở email bằng trình soạn thảo văn bản).

Việc đọc email của nghi phạm có thể giúp thu thập bằng chứng liên quan đến vụ án cho một cuộc điều tra pháp lý, hoặc đối với các mục đích phản hồi sự cố, chúng ta có thể tìm cách xác định các email độc hại có trên hệ thống vào khoảng thời gian hệ thống bị xâm phạm. Sau đó, chúng ta có thể phân tích những dữ liệu này để thu thập các chỉ số đánh giá (indicators) như:
* Người gửi Email (Email Sender)
* Người nhận Email (Email Recipient)
* Ngày và Giờ (Date and Time)
* Dòng Tiêu đề (Subject Line)
* IP của Máy chủ Gửi (Sending Server IP)